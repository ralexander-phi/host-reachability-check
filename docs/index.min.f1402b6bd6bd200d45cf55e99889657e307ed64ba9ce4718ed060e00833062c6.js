function setStatus(e,t){t=="checking"?e.innerText="checking":t=="up"?(e.classList.add("is-success"),e.classList.remove("is-danger"),e.innerText="healthy"):(e.classList.add("is-danger"),e.classList.remove("is-success"),e.innerText="down")}function logMessage(e,t,n){var s=(new Date).toLocaleTimeString(),o=document.createElement("p");o.innerText=s+": "+n,addToListMaxSize(e,o,20),console.log(s+": "+t+" "+n)}function addToListMaxSize(e,t,n){for(;e.childElementCount>=n;)e.removeChild(e.firstChild);e.appendChild(t)}function setup(e){var t,n,s,o,i,a,r,c,l,d,u,h,m,f,p,g,v,b,j,_=document.querySelector("#checks"),y=null;"refreshSeconds"in e&&(y=e.refreshSeconds),p=!0,"burstCache"in e&&(p=e.burstCache);for(grpIdx in e.groups){const w=e.groups[grpIdx],O=w.name;u=null,"about"in w&&(u=w.about),s=document.createElement("details"),s.title="click to show/hide group",s.classList.add("group-detail"),s.open=!0,_.appendChild(s),a=document.createElement("summary"),a.innerText=O,a.classList.add("subtitle"),a.classList.add("is-5"),a.classList.add("mb-5"),s.appendChild(a),r=document.createElement("p"),r.classList.add("pb-6"),s.appendChild(r),u&&(m=document.createElement("p"),m.innerText=u,r.appendChild(m));for(idx in w.monitors){const e=w.monitors[idx],s=e.name,a=e.url,u=e.check;d=null,"about"in e&&(d=e.about),t=document.createElement("details"),t.classList.add("pb-2"),t.classList.add("monitor-detail"),t.title="click to show/hide monitor details",r.appendChild(t),l=document.createElement("summary"),t.appendChild(l),c=document.createElement("span"),c.classList.add("statusOuter"),c.classList.add("pr-2"),l.appendChild(c),i=document.createElement("span"),i.classList.add("tag"),i.classList.add("status"),i.classList.add("monitor-status"),i.innerText="initializing",c.appendChild(i),f=document.createElement("span"),f.innerText=s,l.appendChild(f),n=document.createElement("pre"),n.classList.add("monitor-details"),n.classList.add("m-2"),t.appendChild(n),g=document.createElement("div"),g.innerText="URL: "+a,n.appendChild(g),v=document.createElement("p"),v.innerText="Check Type: "+u,n.appendChild(v),d&&(b=document.createElement("p"),b.innerText=d,n.appendChild(b)),o=y,"refreshSeconds"in e&&(o=e.refreshSeconds),j=null,"params"in e&&(j=e.params),h=p,"burstCache"in e&&(h=e.burstCache),"img"==u?(console.log("Starting img check for "+s+" "+a+" every "+o+" seconds"),imgCheck(s,a,o,h,t)):"http-get"==u?(console.log("Starting http-get check for "+s+" "+a+" every "+o+" seconds"),httpGetCheck(s,a,o,h,j,t)):console.log("Unsure what to do for "+s+" "+u)}}}function genImgCheck(e,t,n,s,o){return function(){imgCheck(e,t,n,s,o)}}function imgCheck(e,t,n,s,o){var i,r,a=o.querySelector(".monitor-status"),c=o.querySelector(".monitor-details");setStatus(a,"checking"),i=document.createElement("img"),i.onload=function(){logMessage(c,e,"up"),i.remove(),setStatus(a,"up"),setTimeout(genImgCheck(e,t,n,s,o),n*1e3)},i.onerror=function(){logMessage(c,e,"down"),i.remove(),setStatus(a,"down"),setTimeout(genImgCheck(e,t,n,s,o),n*1e3)},r=t,s&&(r=addCacheBurst(t)),i.src=r}function genHttpGetCheck(e,t,n,s,o,i){return function(){httpGetCheck(e,t,n,s,o,i)}}function httpGetCheck(e,t,n,s,o,i){var c,a=i.querySelector(".monitor-status"),r=i.querySelector(".monitor-details");setStatus(a,"checking"),c=t,s&&(c=addCacheBurst(t)),fetch(c).then(t=>{o["permitted-status"].includes(t.status)?(logMessage(r,e,"up (status-code: "+t.status+")"),setStatus(a,"up")):(logMessage(r,e,"down (status-code: "+t.status+")"),setStatus(a,"down"))}).catch(t=>{logMessage(r,e,"down (see developer tools network tab)"),setStatus(a,"down")}),setTimeout(genHttpGetCheck(e,t,n,s,o,i),n*1e3)}function addCacheBurst(e){var t=e,n="_cacheBurst="+(new Date).getTime();return t.includes("?")?t+="&"+n:t+="?"+n,t}window.addEventListener("DOMContentLoaded",e=>{document.querySelector("#noscript").remove(),fetch("monitor.json").then(e=>e.json()).then(e=>{setup(e)})})