function setStatus(a,b){b=='checking'?a.innerText='checking':b=='up'?(a.classList.add('is-success'),a.classList.remove('is-danger'),a.innerText='healthy'):(a.classList.add('is-danger'),a.classList.remove('is-success'),a.innerText='down')}function logMessage(d,e,a){var b=(new Date).toLocaleTimeString(),c=document.createElement('p');c.innerText=b+": "+a,addToListMaxSize(d,c,20),console.log(b+": "+e+" "+a)}function addToListMaxSize(a,b,c){while(a.childElementCount>=c)a.removeChild(a.firstChild);a.appendChild(b)}function setup(b){var v=document.querySelector('#checks'),u=null,o,k,d,g,h,n,j,a,l,i,f,p,c,q,r,s,e,t,m;'refreshSeconds'in b&&(u=b.refreshSeconds),o=!0,'burstCache'in b&&(o=b.burstCache);for(grpIdx in b.groups){const w=b.groups[grpIdx],x=w.name;k=null,'about'in w&&(k=w.about),d=document.createElement('details'),d.title="click to show/hide group",d.classList.add('group-detail'),d.open=!0,v.appendChild(d),g=document.createElement('summary'),g.innerText=x,g.classList.add('subtitle'),g.classList.add('is-5'),g.classList.add('mb-5'),d.appendChild(g),h=document.createElement('p'),h.classList.add('pb-6'),d.appendChild(h),k&&(n=document.createElement('p'),n.innerText=k,h.appendChild(n));for(idx in w.monitors){const b=w.monitors[idx],d=b.name,g=b.url,k=b.check;j=null,'about'in b&&(j=b.about),a=document.createElement('details'),a.classList.add('pb-2'),a.classList.add('monitor-detail'),a.title="click to show/hide monitor details",h.appendChild(a),l=document.createElement('summary'),a.appendChild(l),i=document.createElement('span'),i.classList.add('statusOuter'),i.classList.add('pr-2'),l.appendChild(i),f=document.createElement('span'),f.classList.add('tag'),f.classList.add('status'),f.classList.add('monitor-status'),f.innerText='initializing',i.appendChild(f),p=document.createElement('span'),p.innerText=d,l.appendChild(p),c=document.createElement('pre'),c.classList.add('monitor-details'),c.classList.add('m-2'),a.appendChild(c),q=document.createElement('div'),q.innerText="URL: "+g,c.appendChild(q),r=document.createElement('p'),r.innerText="Check Type: "+k,c.appendChild(r),j&&(s=document.createElement('p'),s.innerText=j,c.appendChild(s)),e=u,'refreshSeconds'in b&&(e=b.refreshSeconds),t=null,'params'in b&&(t=b.params),m=o,'burstCache'in b&&(m=b.burstCache),'img'==k?(console.log("Starting img check for "+d+" "+g+" every "+e+" seconds"),imgCheck(d,g,e,m,a)):'http-get'==k?(console.log("Starting http-get check for "+d+" "+g+" every "+e+" seconds"),httpGetCheck(d,g,e,m,t,a)):console.log('Unsure what to do for '+d+' '+k)}}}function genImgCheck(a,b,c,d,e){return function(){imgCheck(a,b,c,d,e)}}function imgCheck(b,e,c,f,d){var g=d.querySelector('.monitor-status'),h=d.querySelector('.monitor-details'),a,i;setStatus(g,'checking'),a=document.createElement('img'),a.onload=function(){logMessage(h,b,"up"),a.remove(),setStatus(g,'up'),setTimeout(genImgCheck(b,e,c,f,d),c*1e3)},a.onerror=function(){logMessage(h,b,"down"),a.remove(),setStatus(g,'down'),setTimeout(genImgCheck(b,e,c,f,d),c*1e3)},i=e,f&&(i=addCacheBurst(e)),a.src=i}function genHttpGetCheck(a,b,c,d,e,f){return function(){httpGetCheck(a,b,c,d,e,f)}}function httpGetCheck(a,c,f,g,h,d){var b=d.querySelector('.monitor-status'),e=d.querySelector('.monitor-details'),i;setStatus(b,'checking'),i=c,g&&(i=addCacheBurst(c)),fetch(i).then(c=>{h['permitted-status'].includes(c.status)?(logMessage(e,a,"up (status-code: "+c.status+")"),setStatus(b,'up')):(logMessage(e,a,"down (status-code: "+c.status+")"),setStatus(b,'down'))}).catch(c=>{logMessage(e,a,"down (see developer tools network tab)"),setStatus(b,'down')}),setTimeout(genHttpGetCheck(a,c,f,g,h,d),f*1e3)}function addCacheBurst(c){var a=c,b='_cacheBurst='+(new Date).getTime();return a.includes('?')?a+='&'+b:a+='?'+b,a}window.addEventListener("DOMContentLoaded",a=>{document.querySelector('#noscript').remove(),fetch('monitor.json').then(a=>a.json()).then(a=>{setup(a)})})