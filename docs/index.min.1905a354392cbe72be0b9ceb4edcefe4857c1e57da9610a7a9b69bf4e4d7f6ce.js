function setStatus(a,b){b=='checking'?a.innerText='checking':b=='up'?(a.classList.add('is-success'),a.classList.remove('is-danger'),a.innerText='healthy'):(a.classList.add('is-danger'),a.classList.remove('is-success'),a.innerText='down')}function setup(a){var l=document.querySelector('#checks'),j=null,i,d,e,b,g,c,k,f;'refreshSeconds'in a&&(j=a.refreshSeconds),i=!0,'burstCache'in a&&(i=a.burstCache);for(grpIdx in a.groups){const m=a.groups[grpIdx],n=m.name;monitorGroup=document.createElement('p'),monitorGroup.classList.add('pb-6'),l.appendChild(monitorGroup),h=document.createElement('h2'),h.innerText=n,h.classList.add('subtitle'),h.classList.add('is-5'),monitorGroup.appendChild(h);for(idx in m.monitors){const a=m.monitors[idx],h=a.name,l=a.url,n=a.check;d=document.createElement('p'),d.title=n+' check for '+l,monitorGroup.appendChild(d),e=document.createElement('span'),e.classList.add('statusOuter'),e.classList.add('pr-2'),d.appendChild(e),b=document.createElement('span'),b.classList.add('tag'),b.classList.add('status'),b.innerText='initializing',e.appendChild(b),g=document.createElement('span'),g.innerText=h,d.appendChild(g),c=j,'refreshSeconds'in a&&(c=a.refreshSeconds),k=null,'params'in a&&(k=a.params),f=i,'burstCache'in a&&(f=a.burstCache),'img'==n?(console.log("Starting img check for "+h+" "+l+" every "+c+" seconds"),imgCheck(h,l,c,f,b)):'http-get'==n?(console.log("Starting http-get check for "+h+" "+l+" every "+c+" seconds"),httpGetCheck(h,l,c,f,k,b)):console.log('Unsure what to do for '+h+' '+n)}}}function genImgCheck(a,b,c,d,e){return function(){imgCheck(a,b,c,d,e)}}function imgCheck(c,d,e,f,b){var a,g;setStatus(b,'checking'),a=document.createElement('img'),a.onload=function(){console.log((new Date).toISOString()+" "+c+" is up"),a.remove(),setStatus(b,'up'),setTimeout(genImgCheck(c,d,e,f,b),e*1e3)},a.onerror=function(){console.log((new Date).toISOString()+" "+c+" is down"),a.remove(),setStatus(b,'down'),setTimeout(genImgCheck(c,d,e,f,b),e*1e3)},g=d,f&&(g=addCacheBurst(d)),a.src=g}function genHttpGetCheck(a,b,c,d,e,f){return function(){httpGetCheck(a,b,c,d,e,f)}}function httpGetCheck(b,c,d,e,f,a){setStatus(a,'checking');var g=c;e&&(g=addCacheBurst(c)),fetch(g).then(c=>{f['permitted-status'].includes(c.status)?(console.log((new Date).toISOString()+" "+b+" is up (status-code: "+c.status+")"),setStatus(a,'up')):(console.log((new Date).toISOString()+" "+b+" is down (status-code: "+c.status+")"),setStatus(a,'down'))}).catch(b=>{setStatus(a,'down')}),setTimeout(genHttpGetCheck(b,c,d,e,f,a),d*1e3)}function addCacheBurst(c){var a=c,b='_cacheBurst='+(new Date).getTime();return a.includes('?')?a+='&'+b:a+='?'+b,a}window.addEventListener("DOMContentLoaded",a=>{document.querySelector('#noscript').remove(),fetch('monitor.json').then(a=>a.json()).then(a=>{setup(a)})})