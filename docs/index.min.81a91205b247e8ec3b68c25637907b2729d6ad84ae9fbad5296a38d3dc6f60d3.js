function setStatus(a,b){a.classList.remove('is-success'),a.classList.remove('is-warning'),a.classList.remove('is-danger'),b=='checking'?(a.classList.add('is-warning'),a.innerText='checking'):b=='up'?(a.classList.add('is-success'),a.innerText='healthy'):(a.classList.add('is-danger'),a.innerText='down')}function setup(a){var k=document.querySelector('#checks'),i=null,h,d,e,b,g,c,j,f;'refreshSeconds'in a&&(i=a.refreshSeconds),h=!0,'burstCache'in a&&(h=a.burstCache);for(idx in a.sites){const l=a.sites[idx].name,m=a.sites[idx].url,n=a.sites[idx].check;d=document.createElement('p'),d.title=n+' check for '+m,k.appendChild(d),e=document.createElement('span'),e.classList.add('statusOuter'),e.classList.add('pr-2'),d.appendChild(e),b=document.createElement('span'),b.classList.add('tag'),b.classList.add('status'),b.classList.add('is-warning'),b.innerText='initializing',e.appendChild(b),g=document.createElement('span'),g.innerText=l,d.appendChild(g),c=i,'refreshSeconds'in a.sites[idx]&&(c=a.sites[idx].refreshSeconds),j=null,'params'in a.sites[idx]&&(j=a.sites[idx].params),f=h,'burstCache'in a.sites[idx]&&(f=a.sites[idx].burstCache),'img'==n?(console.log("Starting img check for "+l+" "+m+" every "+c+" seconds"),imgCheck(l,m,c,f,b)):'http-get'==n?(console.log("Starting http-get check for "+l+" "+m+" every "+c+" seconds"),httpGetCheck(l,m,c,f,j,b)):console.log('Unsure what to do for '+l+' '+n)}}function genImgCheck(a,b,c,d){return function(){imgCheck(a,b,c,d)}}function imgCheck(c,d,f,g,b){var a,e;setStatus(b,'checking'),a=document.createElement('img'),a.onload=function(){console.log((new Date).toISOString()+" "+c+" is up"),a.remove(),setStatus(b,'up')},a.onerror=function(){console.log((new Date).toISOString()+" "+c+" is down"),a.remove(),setStatus(b,'down')},e=d,g&&(e=addCacheBurst(d)),a.src=e,setTimeout(genImgCheck(c,d,f,g,b),f*1e3)}function genHttpGetCheck(a,b,c,d,e,f){return function(){httpGetCheck(a,b,c,d,e,f)}}function httpGetCheck(b,c,d,e,f,a){setStatus(a,'checking');var g=c;e&&(g=addCacheBurst(c)),fetch(g).then(c=>{f['permitted-status'].includes(c.status)?(console.log((new Date).toISOString()+" "+b+" is up (status-code: "+c.status+")"),setStatus(a,'up')):(console.log((new Date).toISOString()+" "+b+" is down (status-code: "+c.status+")"),setStatus(a,'down'))}).catch(b=>{setStatus(a,'down')}),setTimeout(genHttpGetCheck(b,c,d,e,f,a),d*1e3)}function addCacheBurst(c){var a=c,b='_cacheBurst='+(new Date).getTime();return a.includes('?')?a+='&'+b:a+='?'+b,a}window.addEventListener("DOMContentLoaded",a=>{document.querySelector('#noscript').remove(),fetch('monitor.json').then(a=>a.json()).then(a=>{setup(a)})})