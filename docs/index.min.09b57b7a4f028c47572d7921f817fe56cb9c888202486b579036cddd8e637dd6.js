function setStatus(a,b){b=='checking'?a.innerText='checking':b=='up'?(a.classList.add('is-success'),a.classList.remove('is-danger'),a.innerText='healthy'):(a.classList.add('is-danger'),a.classList.remove('is-success'),a.innerText='down')}function logMessage(d,e,a){var b=(new Date).toLocaleTimeString(),c=document.createElement('p');c.innerText=b+": "+a,addToListMaxSize(d,c,20),console.log(b+": "+e+" "+a)}function addToListMaxSize(a,b,c){while(a.childElementCount>=c)a.removeChild(a.firstChild);a.appendChild(b)}function setup(c){var t=document.querySelector('#checks'),s=null,m,f,g,k,h,a,j,i,e,n,b,o,p,q,d,r,l;'refreshSeconds'in c&&(s=c.refreshSeconds),m=!0,'burstCache'in c&&(m=c.burstCache);for(grpIdx in c.groups){const u=c.groups[grpIdx],v=u.name;f=document.createElement('details'),f.open=!0,t.appendChild(f),g=document.createElement('summary'),g.innerText=v,g.classList.add('subtitle'),g.classList.add('is-5'),f.appendChild(g),k=document.createElement('p'),k.classList.add('pb-6'),f.appendChild(k);for(idx in u.monitors){const c=u.monitors[idx],f=c.name,g=c.url,t=c.check;'about'in c?h=c.about:h=null,a=document.createElement('details'),a.classList.add('pb-2'),k.appendChild(a),j=document.createElement('summary'),a.appendChild(j),i=document.createElement('span'),i.classList.add('statusOuter'),i.classList.add('pr-2'),j.appendChild(i),e=document.createElement('span'),e.classList.add('tag'),e.classList.add('status'),e.classList.add('monitor-status'),e.innerText='initializing',i.appendChild(e),n=document.createElement('span'),n.innerText=f,j.appendChild(n),b=document.createElement('pre'),b.classList.add('monitor-details'),b.classList.add('m-2'),a.appendChild(b),o=document.createElement('div'),o.innerText="URL: "+g,b.appendChild(o),p=document.createElement('p'),p.innerText="Check Type: "+t,b.appendChild(p),h&&(q=document.createElement('p'),q.innerText=h,b.appendChild(q)),d=s,'refreshSeconds'in c&&(d=c.refreshSeconds),r=null,'params'in c&&(r=c.params),l=m,'burstCache'in c&&(l=c.burstCache),'img'==t?(console.log("Starting img check for "+f+" "+g+" every "+d+" seconds"),imgCheck(f,g,d,l,a)):'http-get'==t?(console.log("Starting http-get check for "+f+" "+g+" every "+d+" seconds"),httpGetCheck(f,g,d,l,r,a)):console.log('Unsure what to do for '+f+' '+t)}}}function genImgCheck(a,b,c,d,e){return function(){imgCheck(a,b,c,d,e)}}function imgCheck(b,e,c,f,d){var g=d.querySelector('.monitor-status'),h=d.querySelector('.monitor-details'),a,i;setStatus(g,'checking'),a=document.createElement('img'),a.onload=function(){logMessage(h,b,"up"),a.remove(),setStatus(g,'up'),setTimeout(genImgCheck(b,e,c,f,d),c*1e3)},a.onerror=function(){logMessage(h,b,"down"),a.remove(),setStatus(g,'down'),setTimeout(genImgCheck(b,e,c,f,d),c*1e3)},i=e,f&&(i=addCacheBurst(e)),a.src=i}function genHttpGetCheck(a,b,c,d,e,f){return function(){httpGetCheck(a,b,c,d,e,f)}}function httpGetCheck(a,c,f,g,h,d){var b=d.querySelector('.monitor-status'),e=d.querySelector('.monitor-details'),i;setStatus(b,'checking'),i=c,g&&(i=addCacheBurst(c)),fetch(i).then(c=>{h['permitted-status'].includes(c.status)?(logMessage(e,a,"up (status-code: "+c.status+")"),setStatus(b,'up')):(logMessage(e,a,"down (status-code: "+c.status+")"),setStatus(b,'down'))}).catch(c=>{logMessage(e,a,"down (see developer tools network tab)"),setStatus(b,'down')}),setTimeout(genHttpGetCheck(a,c,f,g,h,d),f*1e3)}function addCacheBurst(c){var a=c,b='_cacheBurst='+(new Date).getTime();return a.includes('?')?a+='&'+b:a+='?'+b,a}window.addEventListener("DOMContentLoaded",a=>{document.querySelector('#noscript').remove(),fetch('monitor.json').then(a=>a.json()).then(a=>{setup(a)})})