function setStatus(a,b){a.classList.remove('is-success'),a.classList.remove('is-warning'),a.classList.remove('is-danger'),b=='checking'?(a.classList.add('is-warning'),a.innerText='checking'):b=='up'?(a.classList.add('is-success'),a.innerText='healthy'):(a.classList.add('is-danger'),a.innerText='down')}function setup(b){var g=document.querySelector('#checks'),k=null,i,d,e,a,j,c,l,f;'refreshSeconds'in b&&(k=b.refreshSeconds),i=!0,'burstCache'in b&&(i=b.burstCache);for(grpIdx in b.groups){const m=b.groups[grpIdx],n=m.name;h=document.createElement('h2'),h.classList.add('title'),g.appendChild(h);for(idx in m.monitors){const b=m.monitors[idx],h=b.name,n=b.url,o=b.check;d=document.createElement('p'),d.title=o+' check for '+n,g.appendChild(d),e=document.createElement('span'),e.classList.add('statusOuter'),e.classList.add('pr-2'),d.appendChild(e),a=document.createElement('span'),a.classList.add('tag'),a.classList.add('status'),a.classList.add('is-warning'),a.innerText='initializing',e.appendChild(a),j=document.createElement('span'),j.innerText=h,d.appendChild(j),c=k,'refreshSeconds'in b&&(c=b.refreshSeconds),l=null,'params'in b&&(l=b.params),f=i,'burstCache'in b&&(f=b.burstCache),'img'==o?(console.log("Starting img check for "+h+" "+n+" every "+c+" seconds"),imgCheck(h,n,c,f,a)):'http-get'==o?(console.log("Starting http-get check for "+h+" "+n+" every "+c+" seconds"),httpGetCheck(h,n,c,f,l,a)):console.log('Unsure what to do for '+h+' '+o)}}}function genImgCheck(a,b,c,d){return function(){imgCheck(a,b,c,d)}}function imgCheck(c,d,f,g,b){var a,e;setStatus(b,'checking'),a=document.createElement('img'),a.onload=function(){console.log((new Date).toISOString()+" "+c+" is up"),a.remove(),setStatus(b,'up')},a.onerror=function(){console.log((new Date).toISOString()+" "+c+" is down"),a.remove(),setStatus(b,'down')},e=d,g&&(e=addCacheBurst(d)),a.src=e,setTimeout(genImgCheck(c,d,f,g,b),f*1e3)}function genHttpGetCheck(a,b,c,d,e,f){return function(){httpGetCheck(a,b,c,d,e,f)}}function httpGetCheck(b,c,d,e,f,a){setStatus(a,'checking');var g=c;e&&(g=addCacheBurst(c)),fetch(g).then(c=>{f['permitted-status'].includes(c.status)?(console.log((new Date).toISOString()+" "+b+" is up (status-code: "+c.status+")"),setStatus(a,'up')):(console.log((new Date).toISOString()+" "+b+" is down (status-code: "+c.status+")"),setStatus(a,'down'))}).catch(b=>{setStatus(a,'down')}),setTimeout(genHttpGetCheck(b,c,d,e,f,a),d*1e3)}function addCacheBurst(c){var a=c,b='_cacheBurst='+(new Date).getTime();return a.includes('?')?a+='&'+b:a+='?'+b,a}window.addEventListener("DOMContentLoaded",a=>{document.querySelector('#noscript').remove(),fetch('monitor.json').then(a=>a.json()).then(a=>{setup(a)})})