function setStatus(a,b){a.classList.remove('is-success'),a.classList.remove('is-danger'),b=='checking'?a.innerText='checking':b=='up'?(a.classList.add('is-success'),a.innerText='healthy'):(a.classList.add('is-danger'),a.innerText='down')}function setup(b){var l=document.querySelector('#checks'),j=null,i,d,e,a,g,c,k,f;'refreshSeconds'in b&&(j=b.refreshSeconds),i=!0,'burstCache'in b&&(i=b.burstCache);for(grpIdx in b.groups){const m=b.groups[grpIdx],n=m.name;monitorGroup=document.createElement('p'),monitorGroup.classList.add('pb-6'),l.appendChild(monitorGroup),h=document.createElement('h2'),h.innerText=n,h.classList.add('subtitle'),h.classList.add('is-5'),monitorGroup.appendChild(h);for(idx in m.monitors){const b=m.monitors[idx],h=b.name,l=b.url,n=b.check;d=document.createElement('p'),d.title=n+' check for '+l,monitorGroup.appendChild(d),e=document.createElement('span'),e.classList.add('statusOuter'),e.classList.add('pr-2'),d.appendChild(e),a=document.createElement('span'),a.classList.add('tag'),a.classList.add('status'),a.classList.add('is-light'),a.innerText='initializing',e.appendChild(a),g=document.createElement('span'),g.innerText=h,d.appendChild(g),c=j,'refreshSeconds'in b&&(c=b.refreshSeconds),k=null,'params'in b&&(k=b.params),f=i,'burstCache'in b&&(f=b.burstCache),'img'==n?(console.log("Starting img check for "+h+" "+l+" every "+c+" seconds"),imgCheck(h,l,c,f,a)):'http-get'==n?(console.log("Starting http-get check for "+h+" "+l+" every "+c+" seconds"),httpGetCheck(h,l,c,f,k,a)):console.log('Unsure what to do for '+h+' '+n)}}}function genImgCheck(a,b,c,d){return function(){imgCheck(a,b,c,d)}}function imgCheck(c,d,f,g,b){var a,e;setStatus(b,'checking'),a=document.createElement('img'),a.onload=function(){console.log((new Date).toISOString()+" "+c+" is up"),a.remove(),setStatus(b,'up')},a.onerror=function(){console.log((new Date).toISOString()+" "+c+" is down"),a.remove(),setStatus(b,'down')},e=d,g&&(e=addCacheBurst(d)),a.src=e,setTimeout(genImgCheck(c,d,f,g,b),f*1e3)}function genHttpGetCheck(a,b,c,d,e,f){return function(){httpGetCheck(a,b,c,d,e,f)}}function httpGetCheck(b,c,d,e,f,a){setStatus(a,'checking');var g=c;e&&(g=addCacheBurst(c)),fetch(g).then(c=>{f['permitted-status'].includes(c.status)?(console.log((new Date).toISOString()+" "+b+" is up (status-code: "+c.status+")"),setStatus(a,'up')):(console.log((new Date).toISOString()+" "+b+" is down (status-code: "+c.status+")"),setStatus(a,'down'))}).catch(b=>{setStatus(a,'down')}),setTimeout(genHttpGetCheck(b,c,d,e,f,a),d*1e3)}function addCacheBurst(c){var a=c,b='_cacheBurst='+(new Date).getTime();return a.includes('?')?a+='&'+b:a+='?'+b,a}window.addEventListener("DOMContentLoaded",a=>{document.querySelector('#noscript').remove(),fetch('monitor.json').then(a=>a.json()).then(a=>{setup(a)})})